<% is_channel = messageable.is_a?(Channel) %>
<header class="header" id="<%= dom_id(messageable, :header) %>">
  <span class="name"><%= messageable.display_name %></span>
  <% if is_channel && messageable.auto_join %>
    <span class="auto-join-badge">auto</span>
  <% end %>
  <% if is_channel %>
    <%= form_with model: messageable, class: "auto-join-form" do |f| %>
      <label class="auto-join-toggle">
        <%= f.check_box :auto_join, onchange: "this.form.requestSubmit()" %>
        <span>Auto-join</span>
      </label>
    <% end %>
  <% end %>
  <span class="topic"><%= messageable.subtitle %></span>
  <% if is_channel %>
    <% if messageable.joined %>
      <%= button_to "Leave", channel_path(messageable), method: :delete, class: "leave", data: { turbo_confirm: "Leave #{messageable.name}?" } %>
    <% else %>
      <%= form_with url: server_channels_path(messageable.server), class: "join-form" do |f| %>
        <%= f.hidden_field :name, name: "channel[name]", value: messageable.name %>
        <%= f.submit "Join", class: "join" %>
      <% end %>
    <% end %>

    <button class="userlist-toggle" data-action="userlist-drawer#open" aria-label="Show user list">
      <span class="icon">&#128101;</span>
      <span class="count" id="channel_<%= messageable.id %>_user_count"><%= messageable.channel_users.size %></span>
    </button>
  <% end %>
</header>
