<header class="header" id="<%= dom_id(channel, :header) %>" data-controller="userlist-drawer">
  <span class="name"><%= channel.name %></span>
  <% if channel.auto_join %>
    <span class="auto-join-badge">auto</span>
  <% end %>
  <%= form_with model: channel, class: "auto-join-form" do |f| %>
    <label class="auto-join-toggle">
      <%= f.check_box :auto_join, onchange: "this.form.requestSubmit()" %>
      <span>Auto-join</span>
    </label>
  <% end %>
  <span class="topic"><%= channel.topic %></span>
  <% if channel.joined %>
    <%= button_to "Leave", channel_path(channel), method: :delete, class: "leave", data: { turbo_confirm: "Leave #{channel.name}?" } %>
  <% else %>
    <%= form_with url: server_channels_path(channel.server), class: "join-form" do |f| %>
      <%= f.hidden_field :name, name: "channel[name]", value: channel.name %>
      <%= f.submit "Join", class: "join" %>
    <% end %>
  <% end %>

  <button class="userlist-toggle" data-action="userlist-drawer#open" aria-label="Show user list">
    <span class="icon">&#128101;</span>
    <span class="count"><%= channel.channel_users.size %></span>
  </button>

  <div class="userlist-backdrop" data-userlist-drawer-target="backdrop" data-action="click->userlist-drawer#backdropClick"></div>

  <aside class="userlist-drawer" data-userlist-drawer-target="drawer">
    <div class="header">
      <span class="title">Users (<%= channel.channel_users.size %>)</span>
      <button class="close" data-action="userlist-drawer#close" aria-label="Close user list">&times;</button>
    </div>
    <div class="content">
      <%= render "channels/user_list_content", channel: channel %>
    </div>
  </aside>
</header>
