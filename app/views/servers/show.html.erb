<div class="server-view">
  <header class="header">
    <div class="info">
      <h1 class="address"><%= @server.address %>:<%= @server.port %></h1>
      <% if @server.ssl %>
        <span class="badge">SSL</span>
      <% end %>
      <p class="nickname">as <strong><%= @server.nickname %></strong></p>
    </div>
    <div class="status">
      <% if @server.connected? %>
        <span class="indicator -connected">● Connected</span>
        <span class="since">since <%= @server.connected_at.strftime("%b %d %H:%M") %></span>
      <% else %>
        <span class="indicator -disconnected">○ Disconnected</span>
      <% end %>
    </div>
  </header>

  <section class="actions">
    <% if @server.connected? %>
      <%= button_to "Disconnect", server_connection_path(@server), method: :delete, class: "button -danger" %>
    <% else %>
      <%= button_to "Connect", server_connection_path(@server), method: :post, class: "button -primary" %>
    <% end %>

    <%= link_to "Edit", edit_server_path(@server), class: "button" %>
    <%= button_to "Delete", server_path(@server), method: :delete,
        data: { turbo_confirm: "Delete this server and all its history?" },
        class: "button -danger" %>
  </section>

  <% if @server.connected? %>
    <section class="join">
      <h2>Join Channel</h2>
      <%= form_with url: server_channels_path(@server), class: "form" do |f| %>
        <%= f.text_field :name, name: "channel[name]", placeholder: "#channel", class: "field" %>
        <%= f.submit "Join", class: "button -primary" %>
      <% end %>
    </section>
  <% end %>

  <section class="channels">
    <h2>Channels (<%= @channels.size %>)</h2>
    <% if @channels.any? %>
      <ul class="list">
        <% @channels.each do |channel| %>
          <li class="row">
            <span class="name"><%= channel.name %></span>
            <span class="users"><%= channel.channel_users.size %> users</span>
            <span class="actions">
              <%= link_to "View", channel_path(channel), class: "link" %>
              <%= button_to "Leave", channel_path(channel), method: :delete, class: "link -danger" %>
            </span>
          </li>
        <% end %>
      </ul>
    <% else %>
      <p class="empty">No channels yet. Join one above.</p>
    <% end %>
  </section>

  <section class="messages">
    <details>
      <summary>Server Messages</summary>
      <div class="list">
        <% @server_messages.each do |msg| %>
          <div class="row">
            <span class="time"><%= msg.created_at.strftime("%H:%M:%S") %></span>
            <span class="content"><%= msg.content %></span>
          </div>
        <% end %>
      </div>
    </details>
  </section>
</div>
