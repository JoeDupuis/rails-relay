<section class="channels" id="<%= dom_id(server, :channels) %>">
  <h2>Channels (<%= channels.size %>)</h2>
  <% if channels.any? %>
    <ul class="list">
      <% channels.each do |channel| %>
        <li class="row<%= ' -not-joined' unless channel.joined %>">
          <span class="name"><%= channel.name %></span>
          <% if channel.auto_join %>
            <span class="auto-join-badge">auto</span>
          <% end %>
          <% if channel.joined %>
            <span class="users"><%= channel.channel_users.size %> users</span>
            <span class="actions">
              <%= form_with model: channel, class: "inline-form auto-join-form" do |f| %>
                <%= f.check_box :auto_join, onchange: "this.form.requestSubmit()" %>
              <% end %>
              <%= link_to "View", channel_path(channel), class: "link" %>
              <%= button_to "Leave", channel_path(channel), method: :delete, class: "link -danger" %>
            </span>
          <% else %>
            <span class="status">(not joined)</span>
            <span class="actions">
              <%= form_with model: channel, class: "inline-form auto-join-form" do |f| %>
                <%= f.check_box :auto_join, onchange: "this.form.requestSubmit()" %>
              <% end %>
              <%= form_with url: server_channels_path(server), class: "inline-form" do |f| %>
                <%= f.hidden_field :name, name: "channel[name]", value: channel.name %>
                <%= f.submit "Join", class: "link" %>
              <% end %>
              <%= button_to "Remove", channel_path(channel), method: :delete, class: "link -danger" %>
            </span>
          <% end %>
        </li>
      <% end %>
    </ul>
  <% else %>
    <p class="empty">No channels yet. Join one above.</p>
  <% end %>
</section>
