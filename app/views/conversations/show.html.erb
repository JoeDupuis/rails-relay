<%= turbo_stream_from [ @server, :dm, @conversation.target_nick.downcase ] %>

<div class="channel-view">
  <%= render "channels/header", messageable: @conversation %>

  <div class="messages"
       data-controller="message-list"
       data-message-list-target="messages"
       data-message-list-conversation-id-value="<%= @conversation.id %>"
       data-message-list-history-url-value="<%= conversation_messages_path(@conversation) %>"
       data-message-list-has-more-value="<%= @has_more %>"
       data-message-list-oldest-id-value="<%= @oldest_id %>">
    <div class="loading-indicator -hidden" data-message-list-target="loadingIndicator">
      Loading older messages...
    </div>
    <div id="pm_messages" data-message-list-target="container">
      <%= render partial: "messages/message", collection: @messages %>
    </div>
    <div class="new-messages-indicator -hidden" data-message-list-target="newIndicator" data-action="click->message-list#scrollToNew">
      New messages below
    </div>
  </div>

  <%= render "channels/input", messageable: @conversation %>
</div>
