<%= turbo_stream_from [ @server, :dm, @conversation.target_nick.downcase ] %>

<div class="channel-view">
  <header class="channel-header">
    <h1><%= @conversation.target_nick %></h1>
    <p class="channel-topic">Direct Message</p>
  </header>

  <div class="channel-content">
    <div class="messages"
         data-controller="message-list"
         data-message-list-target="messages"
         data-message-list-conversation-id-value="<%= @conversation.id %>">
      <div id="pm_messages" data-message-list-target="container">
        <%= render partial: "messages/message", collection: @messages %>
      </div>

      <div class="new-messages-indicator -hidden" data-message-list-target="newIndicator" data-action="click->message-list#scrollToNew">
        New messages below
      </div>
    </div>
  </div>

  <div class="message-input">
    <% if @server.connected? %>
      <%= form_with url: conversation_messages_path(@conversation),
          method: :post,
          data: {
            controller: "message-form",
            message_form_message_list_outlet: ".messages",
            action: "submit->message-form#formSubmit"
          } do |form| %>
        <%= form.text_field :content,
            placeholder: "Message #{@conversation.target_nick}",
            autofocus: true,
            id: "content",
            data: { action: "keydown.enter->message-form#submit" } %>
        <%= form.submit "Send" %>
      <% end %>
    <% else %>
      <p>Connect to server to send messages.</p>
    <% end %>
  </div>

  <div class="channel-actions">
    <%= link_to "Back to Server", @server %>
  </div>
</div>
